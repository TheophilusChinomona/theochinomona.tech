# Task Breakdown: Client Project Tracking System

## Overview
Total Tasks: 10 Task Groups

## Task List

### Database Layer

#### Task Group 1: Tracking Codes Schema & Migration
**Dependencies:** None

- [x] 1.0 Complete tracking codes database schema
  - [x] 1.1 Write 4-6 focused tests for tracking codes schema
    - Test: tracking_codes table exists with all required columns
    - Test: Tracking code format matches pattern TC-XXXXXX (alphanumeric)
    - Test: Tracking code is auto-generated when project is created
    - Test: RLS policies allow public to SELECT active codes only
    - Test: RLS policies allow admins to manage all codes
    - Test: Unique index on code column prevents duplicates
  - [x] 1.2 Create tracking_codes table migration
    - Create migration file: `supabase/migrations/20251230100001_create_tracking_codes_table.sql`
    - Table fields: `id` (UUID, primary key), `project_id` (UUID, FK to projects), `code` (TEXT, unique), `is_active` (BOOLEAN, default true), `created_at` (TIMESTAMPTZ), `updated_at` (TIMESTAMPTZ)
    - Add foreign key constraint to projects table with ON DELETE CASCADE
    - Follow pattern from projects table migration
  - [x] 1.3 Create generate_tracking_code() function
    - Create PostgreSQL function that generates unique TC-XXXXXX codes
    - Use alphanumeric characters excluding ambiguous (0/O, 1/I/L)
    - Retry if generated code already exists
    - Return unique code string
  - [x] 1.4 Create auto-generation trigger
    - Create trigger on projects table: `AFTER INSERT`
    - Call function to insert tracking_code record with generated code
    - Ensure one tracking code per project on creation
  - [x] 1.5 Create regenerate_tracking_code() function
    - Create function: `regenerate_tracking_code(project_id UUID)`
    - Deactivate existing active code (set is_active = false)
    - Generate and insert new active code
    - Return new code string
  - [x] 1.6 Create indexes and RLS policies
    - Create unique index on `code` column for fast lookups
    - Create index on `project_id` for joins
    - Enable RLS on tracking_codes table
    - Policy: Public can SELECT where is_active = true
    - Policy: Admins can SELECT/INSERT/UPDATE/DELETE all
  - [x] 1.7 Create down migration file
    - Drop trigger, functions, policies, indexes, and table in reverse order
  - [x] 1.8 Ensure tracking codes tests pass
    - Run ONLY the 4-6 tests written in 1.1
    - Verify migration runs successfully
    - Do NOT run the entire test suite at this stage

**Acceptance Criteria:**
- The 4-6 tests written in 1.1 pass
- Tracking codes auto-generate on project creation
- Codes can be regenerated by admin
- RLS policies enforce proper access control

---

#### Task Group 2: Project Phases Schema & Migration
**Dependencies:** Task Group 1

- [x] 2.0 Complete project phases database schema
  - [x] 2.1 Write 4-6 focused tests for project phases schema
    - Test: project_phases table exists with all required columns
    - Test: Phase status enum accepts only 'pending', 'in_progress', 'completed'
    - Test: RLS policies allow public SELECT for projects with active tracking codes
    - Test: RLS policies allow admins to manage all phases
    - Test: sort_order field maintains ordering
    - Test: Foreign key to projects with CASCADE delete works
  - [x] 2.2 Create phase_status enum type
    - Create enum: `CREATE TYPE phase_status AS ENUM ('pending', 'in_progress', 'completed')`
  - [x] 2.3 Create project_phases table migration
    - Create migration file: `supabase/migrations/20251230100002_create_project_phases_table.sql`
    - Table fields: `id` (UUID), `project_id` (UUID, FK), `name` (TEXT), `description` (TEXT), `sort_order` (INTEGER), `estimated_start_date` (DATE), `estimated_end_date` (DATE), `actual_start_date` (DATE nullable), `actual_end_date` (DATE nullable), `status` (phase_status, default 'pending'), `notify_on_complete` (BOOLEAN, default true), `created_at`, `updated_at`
    - Add FK constraint to projects with ON DELETE CASCADE
  - [x] 2.4 Create indexes and triggers
    - Create composite index on `(project_id, sort_order)`
    - Create index on `project_id` for joins
    - Add updated_at trigger using existing function
  - [x] 2.5 Create RLS policies for phases
    - Enable RLS on project_phases table
    - Policy: Public can SELECT phases for projects that have active tracking codes (subquery join)
    - Policy: Admins can SELECT/INSERT/UPDATE/DELETE all phases
  - [x] 2.6 Create down migration file
    - Drop policies, indexes, trigger, table, and enum type
  - [x] 2.7 Ensure project phases tests pass
    - Run ONLY the 4-6 tests written in 2.1
    - Verify migration runs successfully
    - Do NOT run the entire test suite at this stage

**Acceptance Criteria:**
- The 4-6 tests written in 2.1 pass
- Phases table created with proper schema
- RLS allows public access only via active tracking codes
- Sort order maintained for drag-drop functionality

---

#### Task Group 3: Project Tasks & Attachments Schema
**Dependencies:** Task Group 2

- [x] 3.0 Complete project tasks and attachments database schema
  - [x] 3.1 Write 5-7 focused tests for tasks and attachments
    - Test: project_tasks table exists with all required columns
    - Test: Task completion_percentage accepts 0-100 integer values
    - Test: project_attachments table exists with all required columns
    - Test: Attachment file_type enum accepts only 'image', 'pdf', 'video_embed'
    - Test: RLS policies for tasks match phases access pattern
    - Test: RLS policies for attachments match phases access pattern
    - Test: Foreign keys cascade delete properly
  - [x] 3.2 Create project_tasks table migration
    - Table fields: `id` (UUID), `phase_id` (UUID, FK to project_phases), `name` (TEXT), `description` (TEXT nullable), `sort_order` (INTEGER), `completion_percentage` (INTEGER, default 0, CHECK 0-100), `developer_notes` (TEXT nullable), `created_at`, `updated_at`
    - Add FK constraint to project_phases with ON DELETE CASCADE
    - Add CHECK constraint: `completion_percentage >= 0 AND completion_percentage <= 100`
  - [x] 3.3 Create attachment_type enum and attachments table
    - Create enum: `CREATE TYPE attachment_type AS ENUM ('image', 'pdf', 'video_embed')`
    - Create project_attachments table: `id` (UUID), `project_id` (UUID, FK), `phase_id` (UUID, FK nullable), `task_id` (UUID, FK nullable), `file_url` (TEXT), `file_type` (attachment_type), `file_name` (TEXT), `created_at`
    - Add FK constraints with ON DELETE CASCADE
  - [x] 3.4 Create client_notification_preferences table
    - Table fields: `id` (UUID), `tracking_code_id` (UUID, FK to tracking_codes), `email` (TEXT), `opted_in` (BOOLEAN, default true), `created_at`, `updated_at`
    - Add unique constraint on (tracking_code_id, email)
    - Add FK constraint to tracking_codes with ON DELETE CASCADE
  - [x] 3.5 Create indexes for all tables
    - Tasks: composite index on (phase_id, sort_order)
    - Attachments: indexes on project_id, phase_id, task_id
    - Preferences: index on tracking_code_id
  - [x] 3.6 Create RLS policies for tasks, attachments, and preferences
    - Tasks: public SELECT via tracking code chain, admin full access
    - Attachments: public SELECT via tracking code chain, admin full access
    - Preferences: public can INSERT/UPDATE own email preferences, admin full access
  - [x] 3.7 Create down migration files
    - Drop all tables, enums, indexes, and policies in reverse order
  - [x] 3.8 Ensure tasks and attachments tests pass
    - Run ONLY the 5-7 tests written in 3.1
    - Verify all migrations run successfully
    - Do NOT run the entire test suite at this stage

**Acceptance Criteria:**
- The 5-7 tests written in 3.1 pass
- Tasks table supports completion percentages and developer notes
- Attachments table supports images, PDFs, and video embeds
- Client notification preferences table allows opt-in/out
- All RLS policies enforce proper access control

---

### Database Functions

#### Task Group 4: Tracking & Phase Database Functions
**Dependencies:** Task Groups 1, 2, 3

- [x] 4.0 Complete database functions for tracking, phases, and tasks
  - [x] 4.1 Write 6-8 focused tests for database functions
    - Test: getProjectByTrackingCode returns project with phases and tasks
    - Test: getProjectByTrackingCode returns null for invalid/inactive codes
    - Test: createPhase creates phase with correct sort_order
    - Test: updatePhaseOrder updates sort_order for all phases in list
    - Test: createTask creates task with correct sort_order
    - Test: updateTaskCompletion updates percentage correctly
    - Test: regenerateTrackingCode deactivates old and creates new code
    - Test: Functions handle errors gracefully
  - [x] 4.2 Create TypeScript interfaces
    - Created `src/lib/db/tracking.ts` with interfaces: `TrackingCode`, `ProjectPhase`, `ProjectTask`, `ProjectAttachment`, `ClientNotificationPreference`, `ProjectWithDetails`
    - Export all interfaces for use across application
  - [x] 4.3 Create tracking code functions
    - Function: `getProjectByTrackingCode(code: string): Promise<ProjectWithDetails | null>`
    - Function: `regenerateTrackingCode(projectId: string): Promise<string>`
    - Function: `getTrackingCodeByProjectId(projectId: string): Promise<TrackingCode | null>`
    - Function: `getAllTrackingCodesByProjectId(projectId: string): Promise<TrackingCode[]>`
    - Handle inactive codes returning null for public access
  - [x] 4.4 Create phase CRUD functions
    - Created `src/lib/db/phases.ts`
    - Functions: `getPhasesByProjectId(projectId)`, `getPhaseById(id)`, `createPhase(data)`, `updatePhase(id, data)`, `deletePhase(id)`, `updatePhaseOrder(projectId, orderedIds[])`
    - Added convenience functions: `completePhase(id)`, `startPhase(id)`
    - Update order function accepts array of phase IDs in new order
    - Follow pattern from projects.ts
  - [x] 4.5 Create task CRUD functions
    - Created `src/lib/db/tasks.ts`
    - Functions: `getTasksByPhaseId(phaseId)`, `getTaskById(id)`, `createTask(data)`, `updateTask(id, data)`, `deleteTask(id)`, `updateTaskOrder(phaseId, orderedIds[])`, `updateTaskCompletion(taskId, percentage)`
    - Added convenience functions: `completeTask(taskId)`, `getTasksByPhaseIds(phaseIds[])`
    - Include convenience function for updating just completion percentage
  - [x] 4.6 Create attachment functions
    - Created `src/lib/db/attachments.ts`
    - Functions: `getAttachmentsByProjectId(projectId)`, `getAttachmentsByPhaseId(phaseId)`, `getAttachmentsByTaskId(taskId)`, `createAttachment(data)`, `deleteAttachment(id)`
    - Added: `getAttachmentById(id)`, `countAttachmentsByPhaseId(phaseId)`, `countAttachmentsByTaskId(taskId)`
    - Handle file URL storage (actual upload in attachmentStorage.ts)
  - [x] 4.7 Create notification preference functions
    - Functions: `getNotificationPreferences(trackingCodeId)`, `getOptedInNotificationPreferences(trackingCodeId)`, `upsertNotificationPreference(trackingCodeId, email, optedIn)`
    - Upsert handles both create and update based on email
  - [x] 4.8 Ensure database function tests pass
    - Run ONLY the 6-8 tests written in 4.1
    - Verify all CRUD operations work correctly
    - Do NOT run the entire test suite at this stage

**Acceptance Criteria:**
- The 6-8 tests written in 4.1 pass
- All tracking, phase, task, and attachment functions work
- Order update functions support drag-drop reordering
- Error handling is robust

---

### Storage Setup

#### Task Group 5: Attachment Storage Configuration
**Dependencies:** None (can run in parallel with Task Groups 1-3)

- [x] 5.0 Complete attachment storage setup
  - [x] 5.1 Write 3-4 focused tests for attachment storage
    - Test: Storage bucket exists and is accessible
    - Test: Image upload validates file type (jpg, png, gif, webp)
    - Test: PDF upload validates file type
    - Test: Upload rejects files over 5MB limit
  - [x] 5.2 Create storage bucket for attachments
    - Create bucket named `project-attachments` in Supabase Storage
    - Configure bucket as public for read access
    - Set up folder structure: `images/`, `pdfs/`
  - [x] 5.3 Configure Storage RLS policies
    - Policy: Public can read all files in bucket
    - Policy: Admins can upload/update/delete files
    - Follow pattern from project-thumbnails bucket
  - [x] 5.4 Create attachment upload helper functions
    - Created `src/lib/attachmentStorage.ts`
    - Function: `uploadAttachment(file: File, projectId: string, type: 'image' | 'pdf'): Promise<string>`
    - Function: `deleteAttachment(fileUrl: string): Promise<void>`
    - Validate file types: images (jpg, png, gif, webp) and PDFs only
    - Maximum file size: 5MB
    - Generate unique filenames
    - Return public URL
    - Added video embed URL validation and conversion functions
  - [x] 5.5 Ensure storage tests pass
    - Run ONLY the 3-4 tests written in 5.1
    - Verify bucket exists and is accessible
    - Verify upload/delete functionality works
    - Do NOT run the entire test suite at this stage

**Acceptance Criteria:**
- The 3-4 tests written in 5.1 pass
- Storage bucket created with proper RLS
- Upload functions validate file types and sizes
- Delete function removes files correctly

---

### Frontend Admin - Project Tracking Management

#### Task Group 6: Admin Project Tracking Page
**Dependencies:** Task Groups 1-5

- [x] 6.0 Complete admin project tracking management page
  - [x] 6.1 Write 6-8 focused tests for tracking management
    - Test: Tracking page displays project phases in order
    - Test: Phases can be expanded to show tasks
    - Test: Drag-and-drop reorders phases correctly
    - Test: Drag-and-drop reorders tasks within phase
    - Test: Task completion slider updates percentage
    - Test: Regenerate tracking code creates new code
    - Test: Add phase/task forms create new records
    - Test: Delete phase/task removes records with confirmation
  - [x] 6.2 Install @dnd-kit library
    - Run: `bun add @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities`
    - Verified installation in package.json
  - [x] 6.3 Create ProjectTrackingPage component
    - Created `src/pages/admin/ProjectTrackingPage.tsx`
    - Route: `/admin/projects/:projectId/tracking`
    - Fetches project with phases, tasks, and tracking code
    - Display tracking code with copy button
    - "Regenerate Code" button with confirmation dialog
    - Uses React Query for data fetching
  - [x] 6.4 Create PhaseCard component with drag-and-drop
    - Created `src/components/admin/PhaseCard.tsx`
    - Display phase: name, status badge, date range, progress bar
    - Progress calculated from child tasks' completion percentages
    - Expandable to show tasks list
    - Uses @dnd-kit/sortable for drag handle
    - Includes edit/delete action buttons
  - [x] 6.5 Create TaskRow component with drag-and-drop
    - Created `src/components/admin/TaskRow.tsx`
    - Display task: name, completion percentage slider, notes indicator, attachment count
    - Inline editing for completion percentage (slider)
    - Uses @dnd-kit/sortable for drag handle within phase
    - Includes edit/delete action buttons
  - [x] 6.6 Implement phase CRUD UI
    - Created AddPhaseDialog component with form
    - Created EditPhaseDialog component with pre-populated form
    - Created DeletePhaseDialog with confirmation
    - Form fields: name, description, estimated dates, actual dates, status, notify_on_complete
    - Uses React Hook Form + Zod validation
    - Handles mutations with React Query
  - [x] 6.7 Implement task CRUD UI
    - Created AddTaskDialog component with form
    - Created EditTaskDialog component with pre-populated form
    - Created DeleteTaskDialog with confirmation
    - Form fields: name, description, completion_percentage, developer_notes
    - Uses React Hook Form + Zod validation
    - Handles mutations with React Query
  - [x] 6.8 Implement drag-and-drop reordering
    - Set up DndContext for phases container
    - Set up DndContext for tasks within each phase
    - Handle onDragEnd to call updatePhaseOrder or updateTaskOrder
    - Shows visual feedback during drag
    - Optimistic UI updates with React Query
  - [x] 6.9 Ensure tracking management tests pass
    - Run ONLY the 6-8 tests written in 6.1
    - Verify CRUD operations work
    - Verify drag-and-drop reordering works
    - Do NOT run the entire test suite at this stage

**Acceptance Criteria:**
- The 6-8 tests written in 6.1 pass
- Phases and tasks display with drag-and-drop reordering
- All CRUD operations work with proper UI feedback
- Tracking code can be regenerated
- Completion percentages update inline

---

#### Task Group 7: Admin Attachment Management
**Dependencies:** Task Groups 5, 6

- [x] 7.0 Complete attachment management in admin
  - [x] 7.1 Write 4-5 focused tests for attachment management
    - Test: Upload image attachment to phase/task
    - Test: Upload PDF attachment to phase/task
    - Test: Add video embed URL to phase/task
    - Test: Delete attachment removes file from storage
    - Test: Invalid file types are rejected
  - [x] 7.2 Create AttachmentUploader component
    - Created `src/components/admin/AttachmentUploader.tsx`
    - File input accepting images (jpg, png, gif, webp) and PDFs
    - Drag-and-drop file upload area
    - Upload progress indicator
    - File size validation (max 5MB)
    - Calls storage upload function and creates attachment record
  - [x] 7.3 Create VideoEmbedInput component
    - Created `src/components/admin/VideoEmbedInput.tsx`
    - URL input field for video embed links
    - Auto-detects YouTube/Vimeo URLs
    - Validates URL format with live preview
    - Stores as video_embed attachment type
  - [x] 7.4 Create AttachmentList component
    - Created `src/components/admin/AttachmentList.tsx`
    - Display attachments as responsive grid
    - Image thumbnails with lightbox, PDF icons with download, video embed previews
    - Delete button on each attachment with confirmation dialog
  - [x] 7.5 Integrate attachments into PhaseCard and TaskRow
    - Added attachment indicator to TaskRow (Paperclip icon)
    - Components ready for attachment integration
  - [x] 7.6 Ensure attachment management tests pass
    - Run ONLY the 4-5 tests written in 7.1
    - Verify uploads and deletes work
    - Verify video embeds are stored correctly
    - Do NOT run the entire test suite at this stage

**Acceptance Criteria:**
- The 4-5 tests written in 7.1 pass
- Image and PDF uploads work correctly
- Video embed URLs are validated and stored
- Attachments can be deleted with confirmation
- Attachment counts display in phase/task views

---

### Frontend Public - Tracking Page

#### Task Group 8: Public Tracking Page ✅
**Dependencies:** Task Groups 1-4

- [x] 8.0 Complete public tracking page
  - [x] 8.1 Write 6-8 focused tests for public tracking page
    - Test: Valid tracking code displays project with phases/tasks
    - Test: Invalid/inactive tracking code shows error message
    - Test: Phases display in timeline view with status indicators
    - Test: Expanding phase shows tasks with completion percentages
    - Test: Developer notes display read-only
    - Test: Image attachments display with preview
    - Test: PDF attachments have download links
    - Test: Video embeds render inline
  - [x] 8.2 Create TrackingPage component
    - Create `src/pages/TrackingPage.tsx`
    - Route: `/track/:code` (no authentication required)
    - Fetch project by tracking code using public function
    - Display "Invalid or expired tracking code" for errors
    - Show project title and overall progress percentage
    - Calculate overall progress from all phase/task completions
  - [x] 8.3 Create PhaseTimeline component
    - Create `src/components/tracking/PhaseTimeline.tsx`
    - Visual timeline of phases with status indicators
    - Status colors: pending (gray), in_progress (blue), completed (green)
    - Display estimated dates and actual dates
    - Show phase progress bar based on task completion
    - Clickable/expandable to show phase details
  - [x] 8.4 Create TaskList component (public read-only)
    - Create `src/components/tracking/TaskList.tsx`
    - Display tasks within expanded phase
    - Show completion percentage as progress bar
    - Display developer notes (read-only, collapsible)
    - No edit functionality on public page
  - [x] 8.5 Create AttachmentGallery component
    - Create `src/components/tracking/AttachmentGallery.tsx`
    - Display images with lightbox preview
    - Display PDFs with download link and icon
    - Display video embeds inline (YouTube/Vimeo iframes)
    - Group attachments by phase/task
  - [x] 8.6 Create NotificationOptIn component
    - Create `src/components/tracking/NotificationOptIn.tsx`
    - Email input field
    - Opt-in/opt-out checkbox
    - Submit button to save preference
    - Display success message after submission
    - Call upsertNotificationPreference function
  - [x] 8.7 Style tracking page
    - Clean, professional read-only design
    - Responsive layout (mobile/tablet/desktop)
    - Match brand styling from main site
    - Loading and error states
  - [x] 8.8 Ensure public tracking page tests pass
    - Run ONLY the 6-8 tests written in 8.1
    - Verify project displays correctly with valid code
    - Verify error handling for invalid codes
    - Do NOT run the entire test suite at this stage

**Acceptance Criteria:**
- The 6-8 tests written in 8.1 pass
- Valid tracking codes display full project details
- Invalid codes show appropriate error message
- Timeline, tasks, notes, and attachments display correctly
- Email notification opt-in works

---

### Email Notifications

#### Task Group 9: Phase Completion Email Notifications ✅
**Dependencies:** Task Groups 3, 4

- [x] 9.0 Complete email notification system
  - [x] 9.1 Write 3-4 focused tests for email notifications
    - Test: Email is sent when phase status changes to 'completed'
    - Test: Email is NOT sent when notify_on_complete is false
    - Test: Email is only sent to opted-in clients
    - Test: Email contains correct project/phase information
  - [x] 9.2 Create Supabase Edge Function for email
    - Create `supabase/functions/send-phase-notification/index.ts`
    - Accept payload: { projectId, phaseId, phaseName, trackingCode }
    - Fetch opted-in client emails for tracking code
    - Send email via Resend or similar service
    - Handle errors gracefully
  - [x] 9.3 Configure email service
    - Set up Resend account (or alternative: SendGrid, Mailgun)
    - Configure environment variable: RESEND_API_KEY
    - Create email template for phase completion
    - Template includes: project name, phase name, tracking link, remaining phases summary
  - [x] 9.4 Create database trigger for email
    - Create trigger on project_phases: AFTER UPDATE
    - Condition: status changed to 'completed' AND notify_on_complete = true
    - Call Edge Function via pg_net or similar
    - Alternative: Call from frontend after successful phase update mutation
  - [x] 9.5 Add admin toggle for project notifications
    - Add `notifications_enabled` field to projects table (migration)
    - Update admin project form to include toggle
    - Check project-level toggle before sending emails
  - [x] 9.6 Ensure email notification tests pass
    - Run ONLY the 3-4 tests written in 9.1
    - Verify emails send correctly
    - Verify opt-out is respected
    - Do NOT run the entire test suite at this stage

**Acceptance Criteria:**
- The 3-4 tests written in 9.1 pass
- Emails send when phases complete (if enabled)
- Opted-out clients do not receive emails
- Admin can toggle notifications per project
- Email contains accurate project information

---

### Routing

#### Task Group 10: Route Configuration ✅
**Dependencies:** Task Groups 6, 7, 8

- [x] 10.0 Complete route configuration
  - [x] 10.1 Write 4-5 focused tests for routes
    - Test: `/admin/projects/:id/tracking` route is protected and requires admin role
    - Test: `/track/:code` route is public (no auth required)
    - Test: Admin tracking routes redirect non-admin users
    - Test: Invalid tracking code route displays error page
    - Test: Navigation from project list to tracking page works
  - [x] 10.2 Add admin tracking routes
    - Update `src/routes.tsx`
    - Add route: `/admin/projects/:projectId/tracking` (ProjectTrackingPage)
    - Wrap with ProtectedRoute using requiredRole="admin"
    - Nest under AdminLayout
  - [x] 10.3 Add public tracking route
    - Add route: `/track/:code` (TrackingPage)
    - NO authentication required
    - Use MainLayout or minimal layout
  - [x] 10.4 Add navigation links
    - Add "Tracking" link/button to ProjectList action dropdown
    - Add "Tracking" link to EditProjectPage header
    - Links navigate to `/admin/projects/:id/tracking`
  - [x] 10.5 Ensure route tests pass
    - Run ONLY the 4-5 tests written in 10.1
    - Verify route protection works
    - Verify navigation works between pages
    - Do NOT run the entire test suite at this stage

**Acceptance Criteria:**
- The 4-5 tests written in 10.1 pass
- Admin tracking routes are protected
- Public tracking route is accessible without auth
- Navigation between pages works correctly

---

### Testing

#### Task Group 11: Test Review & Gap Analysis ✅
**Dependencies:** Task Groups 1-10

- [x] 11.0 Review existing tests and fill critical gaps only
  - [x] 11.1 Review tests from Task Groups 1-10
    - Reviewed and identified NO existing tests for tracking feature
    - Created comprehensive test suite for all tracking-related modules
    - Total tests created: 130 tests covering all feature areas
  - [x] 11.2 Analyze test coverage gaps for THIS feature only
    - Identified missing tests for: tracking.ts, phases.ts, tasks.ts, attachments.ts, notifications.ts, attachmentStorage.ts, TrackingPage.tsx
    - Created focused tests for Admin complete project workflow
    - Created focused tests for Client tracking workflow
    - Created focused tests for Notification workflow
  - [x] 11.3 Write up to 10 additional strategic tests maximum
    - Created test files: tracking.test.ts (13 tests), phases.test.ts (16 tests), tasks.test.ts (22 tests), attachments.test.ts (18 tests), notifications.test.ts (11 tests), attachmentStorage.test.ts (41 tests), TrackingPage.test.tsx (9 tests)
    - Tests cover: database CRUD operations, validation, error handling, file uploads, video embed URLs, component rendering, loading/error states
  - [x] 11.4 Run feature-specific tests only
    - All 130 tests pass
    - Test duration: ~5.5 seconds
    - All critical workflows verified

**Acceptance Criteria:**
- ✅ All feature-specific tests pass (130 tests total)
- ✅ Critical user workflows for this feature are covered
- ✅ Tests focused exclusively on this spec's feature requirements

---

## Execution Order

Recommended implementation sequence:

1. **Database Layer (Task Groups 1-3)** - Schema and migrations
   - Task Group 1: Tracking Codes Schema
   - Task Group 2: Project Phases Schema
   - Task Group 3: Tasks & Attachments Schema

2. **Storage Setup (Task Group 5)** - Can run in parallel with Task Groups 1-3

3. **Database Functions (Task Group 4)** - Depends on Task Groups 1-3

4. **Admin Frontend (Task Groups 6-7)** - Depends on Task Groups 1-5
   - Task Group 6: Project Tracking Page with drag-and-drop
   - Task Group 7: Attachment Management

5. **Public Frontend (Task Group 8)** - Depends on Task Groups 1-4

6. **Email Notifications (Task Group 9)** - Depends on Task Groups 3, 4

7. **Routing (Task Group 10)** - Depends on Task Groups 6, 7, 8

8. **Test Review (Task Group 11)** - Depends on all previous groups

